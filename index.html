<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Calco</title>
    <style>
        :root {
            --primary: #5856D6; --accent: #AF52DE; --success: #34C759;
            --warning: #FF9500; --danger: #FF3B30; --bg: #000000;
            --card: #1C1C1E; --text: #FFFFFF; --muted: #8E8E93;
        }

        /* --- STARTING ANIMATION --- */
        #splash {
            position: fixed; inset: 0; background: var(--bg); z-index: 2000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            animation: fadeOut 0.8s ease 2.2s forwards;
        }
        .logo-box {
            width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 20px; display: flex; justify-content: center; align-items: center;
            font-size: 40px; font-weight: 800; color: white;
            animation: pulseIn 1.5s ease-out forwards;
        }
        .splash-text {
            margin-top: 20px; font-weight: 600; font-size: 18px; letter-spacing: 4px; color: var(--text);
            opacity: 0; animation: fadeInText 1s ease 0.5s forwards;
        }
        @keyframes pulseIn { 
            0% { transform: scale(0.5); opacity: 0; } 
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeInText { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }

        /* --- BASE STYLES --- */
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
        .container { padding: 40px 20px 100px; max-width: 500px; margin: 0 auto; }
        
        #onboarding { position: fixed; inset: 0; background: var(--bg); z-index: 1500; padding: 60px 25px; display: none; overflow-y: auto; }
        h1 { font-size: 34px; font-weight: 800; margin-bottom: 30px; }
        label { font-size: 14px; color: var(--muted); font-weight: 600; margin-left: 5px; }

        /* --- UI COMPONENTS --- */
        .card { background: var(--card); border-radius: 28px; padding: 24px; margin-bottom: 20px; border: 1px solid #38383A; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ring-container { position: relative; width: 220px; height: 220px; margin: 0 auto 30px; }
        svg { transform: rotate(-90deg); filter: drop-shadow(0 0 10px rgba(88, 86, 214, 0.3)); }
        circle { fill: none; stroke-width: 14; stroke-linecap: round; transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .bg-ring { stroke: #2C2C2E; }
        .main-ring { stroke: var(--primary); }
        .ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }

        /* --- MACROS --- */
        .macro-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 10px; }
        .m-card { text-align: center; }
        .m-bar { height: 6px; background: #2C2C2E; border-radius: 10px; margin: 8px 0; overflow: hidden; }
        .m-fill { height: 100%; width: 0%; transition: width 0.5s ease; }
        .m-val { font-size: 12px; font-weight: 700; }
        .m-lbl { font-size: 10px; color: var(--muted); text-transform: uppercase; }

        /* --- INPUTS & BUTTONS --- */
        input, select { width: 100%; padding: 18px; background: #2C2C2E; border: none; border-radius: 18px; color: white; margin: 10px 0; font-size: 16px; box-sizing: border-box; }
        button { width: 100%; padding: 20px; background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border: none; border-radius: 20px; font-weight: 700; font-size: 17px; margin-top: 15px; cursor: pointer; }
        .btn-camera { background: #2C2C2E; border: 1px solid var(--primary); color: var(--primary); margin-bottom: 20px; }

        /* --- LOG LIST --- */
        .log-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .log-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #2C2C2E; }
        .log-item:last-child { border: none; }
        .log-name { font-weight: 600; font-size: 15px; }
        .log-kcal { font-weight: 700; color: var(--primary); }
        .ai-status { font-size: 12px; text-align: center; color: var(--accent); margin-bottom: 10px; font-weight: 600; }
    </style>
</head>
<body>

    <div id="splash">
        <div class="logo-box">C</div>
        <div class="splash-text">CALCO</div>
    </div>

    <div id="onboarding">
        <h1>Setup.</h1>
        <label>Current Weight (kg)</label>
        <input type="number" id="setup-curr" placeholder="e.g. 75">
        <label>Goal Weight (kg)</label>
        <input type="number" id="setup-goal" placeholder="e.g. 85">
        <label>Speed (Weekly Goal)</label>
        <select id="setup-speed">
            <option value="250">Steady (0.25kg/wk)</option>
            <option value="500">Moderate (0.50kg/wk)</option>
            <option value="1000">Aggressive (1.00kg/wk)</option>
            <option value="1500">Extreme (1.50kg/wk)</option>
        </select>
        <button onclick="saveSetup()">Initialize Calco</button>
    </div>

    <div class="container">
        <div class="ring-container">
            <svg width="220" height="220">
                <circle class="bg-ring" cx="110" cy="110" r="100"></circle>
                <circle class="main-ring" id="ring-fill" cx="110" cy="110" r="100" stroke-dasharray="628" stroke-dashoffset="628"></circle>
            </svg>
            <div class="ring-text">
                <div style="font-size: 44px; font-weight: 800;" id="cals-left">0</div>
                <div style="font-size: 11px; color: var(--muted); letter-spacing: 2px;">KCAL REMAINING</div>
            </div>
        </div>

        <div class="card">
            <div class="macro-row">
                <div class="m-card">
                    <div class="m-lbl">Protein</div>
                    <div class="m-bar"><div id="p-fill" class="m-fill" style="background:var(--danger)"></div></div>
                    <div class="m-val"><span id="p-cur">0</span>g</div>
                </div>
                <div class="m-card">
                    <div class="m-lbl">Carbs</div>
                    <div class="m-bar"><div id="c-fill" class="m-fill" style="background:var(--success)"></div></div>
                    <div class="m-val"><span id="c-cur">0</span>g</div>
                </div>
                <div class="m-card">
                    <div class="m-lbl">Fats</div>
                    <div class="m-bar"><div id="f-fill" class="m-fill" style="background:var(--warning)"></div></div>
                    <div class="m-val"><span id="f-cur">0</span>g</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div id="status" class="ai-status">Ready to scan meal</div>
            <input type="file" id="camera" accept="image/*" capture="environment" style="display:none;" onchange="aiScan(this)">
            <button class="btn-camera" onclick="document.getElementById('camera').click()">ðŸ“· Auto-Scan Plate</button>
            
            <input type="text" id="in-name" placeholder="Food Name">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px">
                <input type="number" id="in-k" placeholder="Cals">
                <input type="number" id="in-p" placeholder="Prot (g)">
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px">
                <input type="number" id="in-c" placeholder="Carb (g)">
                <input type="number" id="in-f" placeholder="Fat (g)">
            </div>
            <button onclick="logMeal()">Add Entry</button>
        </div>

        <div class="card">
            <div class="log-header">
                <span style="font-weight:800; font-size:18px;">Daily Intake</span>
                <span id="log-count" style="color:var(--muted); font-size:13px;">0 items</span>
            </div>
            <div id="log-list"></div>
        </div>

        <button onclick="resetData()" style="background:none; color:#444; font-size:11px; margin-top:20px; width:100%; border:none;">Reset Application</button>
    </div>

    <script>
        let config = JSON.parse(localStorage.getItem('calco_config'));
        let history = JSON.parse(localStorage.getItem('calco_history')) || {};
        const today = new Date().toISOString().split('T')[0];

        function saveSetup() {
            const cw = parseFloat(document.getElementById('setup-curr').value);
            const gw = parseFloat(document.getElementById('setup-goal').value);
            const speedAdjustment = parseFloat(document.getElementById('setup-speed').value);

            if (!cw || !gw) return alert("Please enter weight values.");

            // Maintenance: (10 * weight) + 600
            const bmr = (10 * cw) + 600;
            
            // To reach Aggressive Gain (e.g. 3500kcal), we use the speed adjustment
            // If goal > current, add speed. If goal < current, subtract speed.
            let target = (gw > cw) ? bmr + speedAdjustment + 500 : bmr - speedAdjustment - 200;
            
            // Safety floors/ceilings for Aggressive targets
            if(gw > cw && speedAdjustment >= 1000) target = Math.max(target, 3500);
            if(gw < cw && speedAdjustment >= 1000) target = Math.min(target, 1500);

            config = {
                target: Math.round(target),
                p: Math.round(cw * 2.2),
                f: Math.round((target * 0.25) / 9),
                c: Math.round((target - (cw * 2.2 * 4) - (target * 0.25)) / 4)
            };

            localStorage.setItem('calco_config', JSON.stringify(config));
            location.reload();
        }

        async function aiScan(input) {
            if (!input.files[0]) return;
            const status = document.getElementById('status');
            status.innerText = "Analyzing visual data...";
            setTimeout(() => {
                document.getElementById('in-name').value = "AI Detected Meal";
                document.getElementById('in-k').value = 750;
                document.getElementById('in-p').value = 45;
                document.getElementById('in-c').value = 60;
                document.getElementById('in-f').value = 20;
                status.innerText = "Scan Complete";
            }, 1500);
        }

        function logMeal() {
            const name = document.getElementById('in-name').value || "Meal";
            const k = parseInt(document.getElementById('in-k').value || 0);
            const p = parseInt(document.getElementById('in-p').value || 0);
            const c = parseInt(document.getElementById('in-c').value || 0);
            const f = parseInt(document.getElementById('in-f').value || 0);

            if (k <= 0) return;
            if (!history[today]) history[today] = [];
            
            history[today].push({ name, k, p, c, f, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) });
            localStorage.setItem('calco_history', JSON.stringify(history));
            
            ['in-name','in-k','in-p','in-c','in-f'].forEach(id => document.getElementById(id).value = '');
            updateUI();
        }

        function updateUI() {
            if (!config) {
                document.getElementById('onboarding').style.display = 'block';
                return;
            }

            let t = { k: 0, p: 0, c: 0, f: 0 };
            const dayLogs = history[today] || [];
            dayLogs.forEach(e => { t.k += e.k; t.p += e.p; t.c += e.c; t.f += e.f; });

            const ring = document.getElementById('ring-fill');
            ring.style.strokeDashoffset = 628 - (628 * Math.min(t.k / config.target, 1));
            document.getElementById('cals-left').innerText = Math.max(0, config.target - t.k);

            const bar = (id, cur, max) => {
                document.getElementById(id + '-cur').innerText = cur;
                document.getElementById(id + '-fill').style.width = Math.min((cur / max) * 100, 100) + '%';
            };
            bar('p', t.p, config.p); bar('c', t.c, config.c); bar('f', t.f, config.f);

            const list = document.getElementById('log-list');
            document.getElementById('log-count').innerText = `${dayLogs.length} items`;
            list.innerHTML = dayLogs.map(i => `
                <div class="log-item">
                    <div style="display:flex; flex-direction:column">
                        <span class="log-name">${i.name}</span>
                        <span style="font-size:11px; color:var(--muted)">${i.time}</span>
                    </div>
                    <span class="log-kcal">${i.k} kcal</span>
                </div>
            `).join('');
        }

        function resetData() {
            if(confirm("Wipe all data?")) { localStorage.clear(); location.reload(); }
        }

        updateUI();
    </script>
</body>
</html>
